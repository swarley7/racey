{"id":"racey-oya","title":"HTTP/3 Single Packet Attack Support","description":"## Overview\nExtend Racey with HTTP/3/QUIC support, implementing a 'Quic-Fin-Sync' technique (analogous to HTTP/2's last-byte synchronization) that withholds final bytes of each request stream, then releases them all in a single UDP packet to trigger simultaneous server-side processing.\n\n## Proposal\nSee: docs/proposals/2025-01-19-http3-single-packet-attack.md\n\n## Tasks\nThis epic contains 6 tasks to implement HTTP/3 single packet attack functionality:\n1. Add quic-go dependency and create http3_client.go scaffold (includes Go version update)\n2. Implement QUIC connection establishment\n3. Implement stream opening and partial request sending\n4. Implement final byte synchronization (Quic-Fin-Sync)\n5. Implement HTTP/3 response collection\n6. Add CLI flags and protocol selection in main.go\n\n## Technical Context\n- Uses github.com/quic-go/quic-go v0.40+ for QUIC/HTTP/3 support\n- Requires Go 1.21+ for quic-go compatibility\n- Implements Quic-Fin-Sync technique: send headers + partial data, then sync final bytes with FIN\n\n## Acceptance Criteria\n- New -http3 CLI flag enables HTTP/3 mode\n- Tool successfully establishes QUIC connections to HTTP/3 servers\n- Multiple HTTP/3 requests are sent with stream FINs synchronized in single packet\n- Response analysis works identically for HTTP/3 responses\n- Existing HTTP/2 functionality remains unchanged when -http3 is not specified\n","status":"open","priority":2,"issue_type":"epic","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:23:44.62131+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:23:44.62131+08:00"}
{"id":"racey-oya.1","title":"Add quic-go dependency and create http3_client.go scaffold","description":"## Goal\nEstablish the foundation for HTTP/3 support by adding the quic-go dependency and creating the initial scaffold for the HTTP/3 client implementation.\n\n## Implementation\n1. Update go.mod:\n   - Change Go version from 1.20 to 1.21 (required for quic-go v0.40+ compatibility)\n   - Add dependency: github.com/quic-go/quic-go v0.40+\n   - Run go mod tidy to resolve transitive dependencies\n\n2. Create http3_client.go with:\n   - Package declaration and imports (quic-go, http3, context, etc.)\n   - Define http3Request struct mirroring HTTP/2 request struct:\n     ```go\n     type http3Request struct {\n         Host           string\n         Request        *http.Request\n         conn           quic.Connection\n         clientConn     *http3.ClientConn\n         streams        []*http3.RequestStream\n         responses      []*Response\n     }\n     ```\n   - Stub functions for dialQUIC(), sendPartialRequests(), sendFinalBytes(), readResponses()\n\n3. Verify build compiles: go build -o /dev/null\n\n## Tests Required\n- [ ] go.mod specifies Go 1.21+\n- [ ] quic-go dependency is present in go.mod\n- [ ] http3_client.go compiles without errors\n- [ ] http3Request struct is defined with required fields\n- [ ] go mod tidy runs without errors\n- [ ] Existing HTTP/2 code still compiles and works\n\n## Acceptance Criteria\n- [ ] Go version updated to 1.21+ in go.mod\n- [ ] quic-go v0.40+ dependency added\n- [ ] http3_client.go scaffold created with types and stub functions\n- [ ] Project builds successfully with go build\n- [ ] No regression in existing HTTP/2 functionality\n","status":"in_progress","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:26:25.170728+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T11:01:18.427801+08:00","dependencies":[{"issue_id":"racey-oya.1","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:26:25.173866+08:00","created_by":"ccarpene-blk"}],"comments":[{"id":1,"issue_id":"racey-oya.1","author":"coordinator","text":"Implementation complete: Added quic-go dependency and created http3_client.go scaffold. Go version updated to 1.22 in go.mod. quic-go v0.48.2 dependency added. http3_client.go scaffold created with http3Request struct (Host, Request, conn, clientConn, streams, responses fields) and 4 stub functions (dialQUIC, sendPartialRequests, sendFinalBytes, readResponses). Project builds successfully. All 6 acceptance criteria verified: Go 1.21+ (actual: 1.22), quic-go v0.40+ (actual: v0.48.2), scaffold created, build passes, HTTP/2 functionality intact, go mod tidy clean.","created_at":"2026-01-19T03:05:03Z"},{"id":2,"issue_id":"racey-oya.1","author":"coordinator","text":"Review APPROVED by worker-2","created_at":"2026-01-19T03:07:19Z"}]}
{"id":"racey-oya.2","title":"Implement QUIC connection establishment","description":"## Goal\nImplement the QUIC connection establishment function that creates a secure connection to HTTP/3 servers with proper TLS configuration and ALPN negotiation.\n\n## Implementation\n1. Implement dialQUIC() function in http3_client.go:\n   ```go\n   func dialQUIC(ctx context.Context, host string, tlsConfig *tls.Config) (quic.Connection, error)\n   ```\n\n2. TLS configuration:\n   - Configure ALPN for 'h3' protocol\n   - Handle InsecureSkipVerify option (matching existing HTTP/2 behavior)\n   - Use TLS 1.3 (required by QUIC)\n\n3. QUIC dial options:\n   - Use quic.DialAddr() or quic.DialAddrContext()\n   - Handle connection timeout (use context)\n   - Handle version negotiation\n\n4. Error handling:\n   - Clear error messages for connection failures\n   - Detect and report if server doesn't support HTTP/3\n   - Handle network unreachable / UDP blocked scenarios\n\n## Tests Required\n- [ ] Unit test: dialQUIC returns connection for valid H3 server (mock or integration)\n- [ ] Unit test: dialQUIC returns error for invalid host\n- [ ] Unit test: TLS config includes 'h3' in NextProtos\n- [ ] Unit test: InsecureSkipVerify option is respected\n- [ ] Integration test: Successfully connects to cloudflare.com:443 with HTTP/3\n\n## Acceptance Criteria\n- [ ] dialQUIC() function implemented and compiles\n- [ ] ALPN correctly negotiates 'h3' protocol\n- [ ] TLS 1.3 is used for the connection\n- [ ] Error messages are clear when connection fails\n- [ ] Context timeout is respected\n- [ ] Connection can be established to real HTTP/3 servers\n","status":"open","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:26:37.502506+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:26:37.502506+08:00","dependencies":[{"issue_id":"racey-oya.2","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:26:37.503168+08:00","created_by":"ccarpene-blk"},{"issue_id":"racey-oya.2","depends_on_id":"racey-oya.1","type":"blocks","created_at":"2026-01-19T10:33:29.946567+08:00","created_by":"ccarpene-blk"}]}
{"id":"racey-oya.3","title":"Implement stream opening and partial request sending","description":"## Goal\nImplement Phase 1 of the Quic-Fin-Sync technique: open multiple QUIC streams and send HTTP/3 request headers with partial body data, withholding the final byte for later synchronization.\n\n## Implementation\n1. Implement sendPartialRequests() in http3_client.go:\n   ```go\n   func (r *http3Request) sendPartialRequests(count int, req *http.Request) error\n   ```\n\n2. Stream management:\n   - Create http3.Transport and get ClientConn using NewClientConn()\n   - Open 'count' request streams using clientConn.OpenRequestStream()\n   - Track all streams in http3Request.streams slice\n\n3. Send partial requests:\n   - For each stream, call SendRequestHeader(req) to send HEADERS frame\n   - If request has body, write all but the final byte using stream.Write()\n   - Do NOT close the stream yet (no FIN flag)\n\n4. Handle request preparation:\n   - Clone the original http.Request for each stream\n   - Set correct headers (:authority, :method, :path, :scheme)\n   - Handle Content-Length if body is present\n\n5. Server limits:\n   - Respect MAX_STREAMS from server's transport parameters\n   - Warn if requested count exceeds server limit\n\n## Tests Required\n- [ ] Unit test: sendPartialRequests opens correct number of streams\n- [ ] Unit test: Headers are sent correctly via SendRequestHeader\n- [ ] Unit test: Body data minus final byte is written to stream\n- [ ] Unit test: Streams remain open (no FIN sent yet)\n- [ ] Unit test: Handles requests with no body (headers only)\n- [ ] Unit test: Warns when count exceeds MAX_STREAMS\n\n## Acceptance Criteria\n- [ ] sendPartialRequests() function implemented\n- [ ] Multiple streams opened on single QUIC connection\n- [ ] Request headers sent correctly on each stream\n- [ ] Request body (if any) sent minus final byte\n- [ ] Streams remain in 'half-open' state ready for sync\n- [ ] Server MAX_STREAMS limit is respected with warning\n","status":"open","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:26:56.366025+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:26:56.366025+08:00","dependencies":[{"issue_id":"racey-oya.3","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:26:56.366719+08:00","created_by":"ccarpene-blk"},{"issue_id":"racey-oya.3","depends_on_id":"racey-oya.2","type":"blocks","created_at":"2026-01-19T10:33:30.015216+08:00","created_by":"ccarpene-blk"}]}
{"id":"racey-oya.4","title":"Implement final byte synchronization (Quic-Fin-Sync)","description":"## Goal\nImplement Phase 2 of the Quic-Fin-Sync technique: after the delay period, send the final byte on all streams and close them with FIN flags in rapid succession to trigger simultaneous server-side processing.\n\n## Implementation\n1. Implement sendFinalBytes() in http3_client.go:\n   ```go\n   func (r *http3Request) sendFinalBytes(finalByte []byte) error\n   ```\n\n2. Synchronization sequence:\n   - Accept configurable delay (matching HTTP/2's -delay flag behavior)\n   - After delay, iterate through all streams rapidly\n   - For each stream:\n     - Write the final byte (if any body): stream.Write(finalByte)\n     - Call stream.Close() to send FIN flag\n   - All close operations must happen in tight loop for synchronization\n\n3. Connection warming (optional, matching HTTP/2):\n   - Consider ICMP ping before final byte sync (like HTTP/2 implementation)\n   - May help ensure all FINs go in same UDP datagram\n\n4. Error handling:\n   - Handle stream write errors gracefully\n   - Continue with other streams if one fails\n   - Report which streams failed\n\n## Tests Required\n- [ ] Unit test: sendFinalBytes writes final byte to each stream\n- [ ] Unit test: sendFinalBytes calls Close() on each stream\n- [ ] Unit test: Operations happen in rapid succession (timing test)\n- [ ] Unit test: Handles streams with no final byte (headers-only requests)\n- [ ] Unit test: Continues processing if one stream errors\n- [ ] Integration test: FIN flags are batched in single UDP packet (wireshark/tcpdump verification approach documented)\n\n## Acceptance Criteria\n- [ ] sendFinalBytes() function implemented\n- [ ] Final byte written to each stream (if applicable)\n- [ ] FIN flag sent via Close() on all streams\n- [ ] Operations happen in tight loop for synchronization\n- [ ] Errors on individual streams don't stop other streams\n- [ ] Delay before sync is configurable (reuses -delay flag)\n","status":"open","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:27:09.828231+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:27:09.828231+08:00","dependencies":[{"issue_id":"racey-oya.4","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:27:09.828878+08:00","created_by":"ccarpene-blk"},{"issue_id":"racey-oya.4","depends_on_id":"racey-oya.3","type":"blocks","created_at":"2026-01-19T10:33:30.084176+08:00","created_by":"ccarpene-blk"}]}
{"id":"racey-oya.5","title":"Implement HTTP/3 response collection","description":"## Goal\nImplement response collection from HTTP/3 streams, parsing headers and bodies into a shared Response struct that can be used by the existing response analysis code.\n\n## Implementation\n1. Implement readResponses() in http3_client.go:\n   ```go\n   func (r *http3Request) readResponses() ([]*Response, error)\n   ```\n\n2. Response reading:\n   - For each stream in r.streams, call stream.ReadResponse()\n   - Parse response headers and status code\n   - Read response body fully\n\n3. Response struct integration:\n   - Convert http3 responses to shared Response struct (may need to define or reuse from HTTP/2)\n   - Include: StatusCode, Headers, Body, StreamID/identifier\n   - Ensure compatibility with existing analyzeResponses() function\n\n4. Concurrent collection:\n   - Consider using goroutines to read responses concurrently\n   - Use sync.WaitGroup to wait for all responses\n   - Handle timeouts for slow responses\n\n5. Error handling:\n   - Handle stream reset (RST_STREAM equivalent)\n   - Handle connection errors\n   - Track which streams failed vs succeeded\n\n## Tests Required\n- [ ] Unit test: readResponses collects response from each stream\n- [ ] Unit test: Status codes are correctly extracted\n- [ ] Unit test: Headers are correctly parsed\n- [ ] Unit test: Response bodies are fully read\n- [ ] Unit test: Handles stream errors gracefully\n- [ ] Unit test: Response struct compatible with analyzeResponses()\n- [ ] Integration test: Full request/response cycle works end-to-end\n\n## Acceptance Criteria\n- [ ] readResponses() function implemented\n- [ ] Responses collected from all streams\n- [ ] Response struct contains status, headers, body\n- [ ] Compatible with existing analyzeResponses() function\n- [ ] Timeout handling for slow responses\n- [ ] Clear error reporting for failed streams\n","status":"open","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:27:22.29608+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:27:22.29608+08:00","dependencies":[{"issue_id":"racey-oya.5","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:27:22.29675+08:00","created_by":"ccarpene-blk"},{"issue_id":"racey-oya.5","depends_on_id":"racey-oya.4","type":"blocks","created_at":"2026-01-19T10:33:30.154567+08:00","created_by":"ccarpene-blk"}]}
{"id":"racey-oya.6","title":"Add CLI flags and protocol selection in main.go","description":"## Goal\nAdd the -http3 CLI flag and implement protocol selection logic in main.go to allow users to choose between HTTP/2 and HTTP/3 modes.\n\n## Implementation\n1. Add CLI flags in main.go:\n   - Add `-http3` / `--http3` boolean flag (default: false)\n   - Optional: Add `-alpn` flag for custom ALPN override\n   - Update usage/help text to document new flags\n\n2. Protocol selection logic:\n   - If `-http3` flag is set, use HTTP/3 code path\n   - Otherwise, use existing HTTP/2 code path (default behavior unchanged)\n   - Implement main orchestration function for HTTP/3:\n     ```go\n     func runHTTP3Attack(target string, count int, delay int, ...) error\n     ```\n\n3. Integration with HTTP/3 client:\n   - Call dialQUIC() for connection\n   - Call sendPartialRequests() for Phase 1\n   - Apply delay\n   - Call sendFinalBytes() for Phase 2\n   - Call readResponses() for response collection\n   - Pass responses to existing analyzeResponses()\n\n4. Shared utilities:\n   - Ensure Response struct is shared between HTTP/2 and HTTP/3\n   - Refactor any duplicated code (header parsing, etc.)\n   - Ensure -count, -delay, -log flags work with HTTP/3\n\n5. Error handling:\n   - Clear error when HTTP/3 connection fails\n   - Suggest checking if server supports HTTP/3\n\n## Tests Required\n- [ ] Unit test: -http3 flag is parsed correctly\n- [ ] Unit test: HTTP/3 mode is selected when flag is set\n- [ ] Unit test: HTTP/2 mode remains default when flag not set\n- [ ] Unit test: -count flag works with HTTP/3\n- [ ] Unit test: -delay flag works with HTTP/3\n- [ ] Unit test: -log flag captures HTTP/3 responses\n- [ ] Integration test: Full HTTP/3 attack against test server\n- [ ] Regression test: HTTP/2 functionality unchanged\n\n## Acceptance Criteria\n- [ ] -http3 flag added and documented\n- [ ] Protocol selection works correctly\n- [ ] HTTP/3 attack orchestration implemented\n- [ ] All existing flags work with HTTP/3 mode\n- [ ] Response analysis works for HTTP/3 responses\n- [ ] Existing HTTP/2 functionality unchanged\n- [ ] Help text updated with HTTP/3 documentation\n","status":"open","priority":2,"issue_type":"task","owner":"ccarpene@block.xyz","created_at":"2026-01-19T10:33:22.623449+08:00","created_by":"ccarpene-blk","updated_at":"2026-01-19T10:33:22.623449+08:00","dependencies":[{"issue_id":"racey-oya.6","depends_on_id":"racey-oya","type":"parent-child","created_at":"2026-01-19T10:33:22.624104+08:00","created_by":"ccarpene-blk"},{"issue_id":"racey-oya.6","depends_on_id":"racey-oya.5","type":"blocks","created_at":"2026-01-19T10:33:30.224175+08:00","created_by":"ccarpene-blk"}]}
